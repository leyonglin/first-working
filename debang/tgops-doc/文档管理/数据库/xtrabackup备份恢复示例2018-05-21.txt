

全备+差异备
qpress是一个使用QuickLZ的便携式文件存档程序，旨在最大限度地利用快速存储系统。它通常比文件复制更快


下载网址：https://www.percona.com/downloads/percona-release/redhat/

wget https://www.percona.com/redir/downloads/percona-release/redhat/0.1-4/percona-release-0.1-4.noarch.rpm
yum -y install percona-xtrabackup-24 qpress
全备：innobackupex  --defaults-file=/opt/conf/my_16303.cnf  --use-memory=10G --compress --compress-threads=24  -uroot -p  -S  /opt/data/data_16303/mysql.sock  /backup/data_back/xtrabackup/full
差异备：mkdir  /backup/data_back/xtrabackup/incre/2018-05-20_12-33-46
innobackupex  --defaults-file=/opt/conf/my_16303.cnf  --use-memory=10G --compress --compress-threads=24  -uroot -p  -S  /opt/data/data_16303/mysql.sock  --incremental /backup/data_back/xtrabackup/incre/2018-05-20_12-33-46
  --incremental-basedir /backup/data_back/xtrabackup/full/2018-05-20_12-33-46
压缩并拷贝到其它服务器：
恢复：mkdir /opt/src/{full,incre}
1.innobackupex --decompress --parallel=32 --remove-original  /opt/src/full/2018-05-20_12-33-46/              解压  
1.innobackupex --apply-log --use-memory=4G --redo-only /opt/src/full/2018-05-20_12-33-46/                    应用日志
2.innobackupex --decompress --parallel=16 /backup/data_back/incre/2018-05-20_12-33-46/2018-05-20_13-00-09/   解压
3.innobackupex --apply-log --use-memory=4G /backup/data_back/full/2018-05-20_12-33-46/  
--incremental-dir=/backup/data_back/incre/2018-05-20_12-33-46/2018-05-20_13-00-09/                           合并日志
4.less /backup/data_back/full/2018-05-20_12-33-46/xtrabackup_checkpoints                                     查看
5.mysqladmin  -uroot -p -S /opt/data/data_16303/mysql.sock shutdown                                          停止数据库
6.mv /opt/data/data_16303/ /opt/data/data_16303.bak && mkdir /opt/data/data_16303                            备份并创建新数据目录
7.innobackupex --defaults-file=/opt/conf/my_16303.cnf --use-memory=4G  --copy-back  
  /backup/data_back/full/2018-05-20_12-33-46/                                                                恢复数据
8.启动数据库
9.less incre/2018-05-20_12-33-46/2018-05-20_13-00-09/xtrabackup_binlog_info                 查看最后一次差异备份的binlog_info        less incre/2018-05-20_18-32-32/2018-05-21_19-19-26/xtrabackup_info   


思路：找到全备+最近的差备文件--->合并回滚日志（操作同第二节）--->找到最新差备时间点导故障点的binlog日志文件--->mysqlbinlog翻译（以差备最后的pos为起点）成sql文件---->copy-back到新库、source 翻译后的sql文件